---
- name: "PureFTPd | Configure /etc/default/pure-ftpd-common"
  template:
    src: pure-ftpd-common
    dest: /etc/default/pure-ftpd-common
  when: not ansible_check_mode

- name: "PureFTPd | TLS Activation"
  shell: echo 1 > /etc/pure-ftpd/conf/TLS
  when: not ansible_check_mode

- name: "PureFTPd | Create tls directory"
  file:
    path: /etc/ssl/private
    state: directory

- name: "PureFTPd | Check /etc/fstab"
  shell: cat /etc/fstab
  register: fstab_quota

- name: "PureFTPd | Configure /etc/fstab"
  lineinfile:
    path: /etc/fstab
    regexp: '/dev/mapper/Debian9--Template--vg-root /               ext4    errors=remount-ro 0       1'
    line: '/dev/mapper/Debian9--Template--vg-root /               ext4    errors=remount-ro,usrjquota=quota.user,grpjquota=quota.group,jqfmt=vfsv0 0       1'
  when: fstab_quota.stdout.find('usrjquota') !=1

- name: "PureFTPd | Finalizing 1/3"
  command: mount -o remount /
  when: not ansible_check_mode and fstab_quota.stdout.find('usrjquota') !=1

- name: "PureFTPd | Finalizing 2/3"
  command: quotacheck -avugm
  ignore_errors: yes
  when: not ansible_check_mode and fstab_quota.stdout.find('usrjquota') !=1

- name: "PureFTPd | Finalizing 2/3"
  command: quotaon -avug
  ignore_errors: yes
  when: not ansible_check_mode and fstab_quota.stdout.find('usrjquota') !=1

