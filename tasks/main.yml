---
- name: Include jailkit
  include: jailkit.yml
  tags:
    - ispconfig

- name: Include apt
  include: apt.yml
  tags:
    - ispconfig

- name: Include postfix
  include: postfix.yml
  tags:
    - ispconfig

- name: Include mailman
  include: mailman.yml
  tags:
    - ispconfig

- name: Include pure-ftpd
  include: pure-ftpd.yml
  tags:
    - ispconfig

- name: Include apache2
  include: apache2.yml
  tags:
    - ispconfig
  when: not ansible_check_mode

- name: Include mysql
  include: mysql.yml
  tags:
    - ispconfig
  when: not ansible_check_mode

- name: "MySQL Secure | Check /etc/facts.conf for mysql_secure=yes"
  shell: grep -c mysql_secure=yes /etc/facts/conf
  register: facts_mysql_secure
  failed_when: "'FAILED' in facts_mysql_secure.stderr"

- name: Include mysql-secure
  include: mysql_secure_installation.yml
  tags:
    - ispconfig
  when: not ansible_check_mode and facts_mysql_secure == "0"

- name: Include others
  include: others.yml
  tags:
    - ispconfig

- name: Include ispconfig-installer
  include: ispconfig-installer.yml
  tags:
    - ispconfig

- name: Include ispconfig-ssl
  include: ispconfig-installer.yml
  tags:
    - ispconfig

- name: Include services
  include: services.yml
  tags:
    - ispconfig
