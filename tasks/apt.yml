---
- name: "Packages | apt-get update"
  apt:
    update_cache: yes

- name: "Packages | Upgrade all packages to the latest version"
  apt:
    name: "*"
    state: latest

- name: "Packages | Set Postfix option as internet site"
  debconf: name=postfix question="postfix/main_mailer_type" value="'Internet Site'" vtype="string"

- name: "Packages | Set Postfix option hostname"
  debconf: name=postifx question="postfix/mailname" value="{{ hostname_fqdn }}" vtype="string"

- name: "Packages | Debconf for phpmyadmin"
  debconf:
    name: phpmyadmin
    question: "{{ item.question }}"
    value: "{{ item.value }}"
    vtype: "{{ item.vtype }}"
  with_items:
    - { question: 'phpmyadmin/reconfigure-webserver', value: 'apache2', vtype: 'multiselect' }
    - { question: 'phpmyadmin/dbconfig-install', value: 'true', vtype: 'boolean' }
    - { question: 'phpmyadmin/mysql/admin-pass', value: '', vtype: 'password' }

- name: "Packages | Debconf for mailman"
  debconf:
    name: mailman
    question: "{{ item.question }}"
    value: "{{ item.value }}"
    vtype: "{{ item.vtype }}"
  with_items:
    - { question: 'mailman/used_languages', value: 'en', vtype: 'multiselect' }
    - { question: 'mailman/create_site_list', value: '', vtype: 'multiselect' }

- name: "Packages | Debconf for roundcube"
  debconf:
    name: roundcube
    question: "{{ item.question }}"
    value: "{{ item.value }}"
    vtype: "{{ item.vtype }}"
  with_items:
    - { question: 'roundcube/dbconfig-install', value: 'true', vtype: 'boolean' }
    - { question: 'roundcube/password-confirm', value: '', vtype: 'password' }
    - { question: 'roundcube/mysql/admin-pass', value: '{{ mysql_root_password }}', vtype: 'password' }

- name: "Packages | Install ISPConfig base packages"
  apt:
    name: "{{ item }}"
    state: present
  with_items: "{{ ispconfig_packages }}"
